<div class="page-header">
    <!-- page location, org -->
    <div class="meta">
        <div class="page">
            Datasets
        </div>
        <div class="organization">
            <span class="fa fa-institution"></span>
            <span>{{ orgId }}</span>
        </div>
    </div>
    <!-- page specifiction actions/tools -->
    <div class="actions">
        <form class="form-inline">
            <div class="form-group">
                <label>Filter:</label>
                <input type="text" class="form-control" data-ng-model="specFilter" placeholder="dataset"/>
            </div>
            <div class="form-group">
                <a href class="btn btn-default pull-right" data-ng-click="newFileOpen = true"><i class="fa fa-star"></i> New Dataset</a>
            </div>
        </form>
    </div>
</div>

<div class="file-list">
    <div data-ng-if="!datasets.length" class="col-md-12">
        <h4>No datasets</h4>
    </div>
    <div ng-repeat="dataset in filteredDatasets" class="col-md-12">
        <div data-ng-include="'dataset-entry.html'">entry</div>
    </div>
    <div data-ng-show="newFileOpen">
        <div data-ng-include="'new-dataset.html'">new dataset</div>
    </div>
</div>

<script type="text/ng-template" id="new-dataset.html">
    <div class="aside-backdrop am-fade" style=""></div>
    <div class="aside right animated fadeInRightBig">
        <div class="aside-dialog">
            <div class="aside-content">
                <div class="aside-header">
                    Create a new dataset:
                </div>
                <div class="aside-body">
                    <form name="form" class="form">
                        <fieldset>
                            <div class="form-group">
                                <label for="new-name">Dataset Short Name</label>
                                <input id="new-name" class="form-control" data-ng-model="newDataset.specTyped" placeholder="spec" required autofocus/>
                            </div>
                            <div data-ng-if="characters.length > 1">
                                <span data-ng-repeat="ch in characters" class="radio">
                                    <label><input type="radio" name="character" data-ng-model="newDataset.character" data-ng-value="ch"> {{ ch.title }}</label>
                                </span>
                            </div>
                            <div data-ng-if="characters.length == 1">
                                {{ characters[0].title }}
                            </div>
                            <hr/>
                            <div class="form-group">
                                <span typ="button" class="btn btn-success" data-ng-class="{ 'disabled': !newDataset.enabled }" data-ng-click="createDataset()">
                                    <i class="fa fa-plus"></i> <span>Create</span>
                                    <span>"{{ newDataset.spec }}"</span>
                                </span>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <div class="aside-footer">
                    <button type="button" class="btn btn-default" data-ng-click="cancelNewFile()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/ng-template" id="dataset-entry.html">

    <div data-ng-controller="DatasetEntryCtrl" class="widget">

        <div class="widget-header">
            <!-- todo: should be a caret down to indicate expansion -->
            <span class="clickable" data-ng-click="expanded = !expanded">
                <span class="widget-icon"><i class="fa fa-fw" data-ng-class="{ 'fa-folder': !expanded, 'fa-folder-open': expanded }"></i></span>
                <strong>{{ dataset.datasetSpec }}</strong> <span data-ng-if="dataset.datasetName">: "{{ dataset.datasetName }}"</span>
            </span>
            <span class="pull-right" data-ng-show="dataset.processedValid || dataset.processedInvalid">
                <span class="btn btn-warning" data-ng-click="showInvalidRecordsPage()">
                    <i class="fa fa-fw fa-bug"></i>
                    <span>{{ dataset.processedInvalid }}/{{ dataset.datasetRecordCount }}</span>
                </span>
                <span class="btn btn-success" data-ng-click="goToDataset()">
                    <i class="fa fa-fw fa-eye"></i>
                    <span>{{ dataset.processedValid }}/{{ dataset.datasetRecordCount }}</span>
                </span>
            </span>
            <span data-ng-show="dataset.datasetRecordCount && !dataset.processedValid" class="btn btn-default pull-right" data-ng-click="goToDataset()">
                <i class="fa fa-fw fa-code" data-ng-show="dataset.stateAnalyzed"></i>
                <span>{{ dataset.datasetRecordCount }}</span>
            </span>
        </div>

        <div data-ng-if="dataset.progress" class="widget-body">
            <div class="input-group">
                <progressbar class="form-control-feedback" animate="true" value="dataset.progress.count" max="100">{{ dataset.progress.message }}</progressbar>
                <div class="input-group-btn">
                    <button class="btn btn-danger btn-xs" data-ng-click="interruptProcessing(file)" data-ng-show="dataset.progress">
                        <i class="fa fa-trash-o"></i> <span>Interrupt</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="widget-body" data-ng-if="expanded && !dataset.progress">

            <div class="rowsdf">

                <!--todo: maybe put this all inside a tab-->
                <div class="ds-states">
                    <div data-ng-show="dataset.empty">
                        <div><strong>Empty</strong></div>
                    </div>
                    <div data-ng-show="dataset.stateRaw" class="ds-state">
                        <div><strong>Raw</strong></div>
                        <div class="small">{{ dataset.stateRaw.d }}</div>
                        <div>{{ dataset.stateRaw.t }}</div>
                        <div>
                            <button class="btn btn-sm btn-success" data-ng-click="startRawAnalysis()">
                                <i class="fa fa-fw fa-bar-chart"></i> <span>Analyze</span>
                            </button>
                        </div>
                    </div>
                    <div data-ng-show="dataset.stateRawAnalyzed" class="ds-state">
                        <div><strong>Raw Analyzed</strong></div>
                        <div class="small">{{ dataset.stateRawAnalyzed.d }}</div>
                        <div>{{ dataset.stateRawAnalyzed.t }}</div>
                        <button class="btn btn-sm btn-info" data-ng-click="goToDataset()">
                            <i class="fa fa-fw fa-eye"></i> <span>Delimit</span>
                        </button>
                    </div>
                    <div data-ng-show="dataset.stateSourced" class="ds-state"
                         data-ng-class="{ 'later': isLater(dataset.stateSourced, dataset.stateMappable) }">
                        <div><strong>Sourced</strong></div>
                        <div class="small">{{ dataset.stateSourced.d }}</div>
                        <div>{{ dataset.stateSourced.t }}</div>
                        <div>
                            <button class="btn btn-sm btn-success" data-ng-click="startGeneratingSip()">
                                <i class="fa fa-fw fa-cube"></i> <span>Make SIP</span>
                            </button>
                        </div>
                    </div>
                    <div data-ng-show="dataset.stateMappable" class="ds-state"
                         data-ng-class="{ 'later': isLater(dataset.stateMappable, dataset.stateProcessable) }">
                        <div><strong>Mappable</strong></div>
                        <div class="small">{{ dataset.stateMappable.d }}</div>
                        <div>{{ dataset.stateMappable.t }}</div>
                        <div>
                            <a href="{{sipCreatorLink}}" class="btn btn-sm btn-default">
                                <i class="fa fa-fw fa-download"></i> Mapper
                            </a>
                        </div>
                    </div>
                    <div data-ng-show="dataset.stateProcessable" class="ds-state"
                         data-ng-class="{ 'later': isLater(dataset.stateProcessable, dataset.stateProcessed) }">
                        <div><strong>Processable</strong></div>
                        <div class="small">{{ dataset.stateProcessable.d }}</div>
                        <div>{{ dataset.stateProcessable.t }}</div>
                        <div>
                            <button class="btn btn-sm btn-success" data-ng-click="startProcessing()">
                                <i class="fa fa-fw fa-cogs"></i> <span>Process</span>
                            </button>
                        </div>
                    </div>
                    <div data-ng-show="dataset.stateProcessed" class="ds-state"
                         data-ng-class="{ 'later': isLater(dataset.stateProcessed, dataset.stateAnalyzed) }">
                        <div><strong>Processed</strong></div>
                        <div class="small">{{ dataset.stateProcessed.d }}</div>
                        <div>{{ dataset.stateProcessed.t }}</div>
                        <div>
                            <button class="btn btn-sm btn-success" data-ng-click="startProcessedAnalysis()">
                                <i class="fa fa-fw fa-bar-chart"></i> <span>Analyze</span>
                            </button>
                        </div>
                    </div>
                    <div data-ng-show="dataset.stateAnalyzed" class="ds-state"
                         data-ng-class="{ 'later': isLater(dataset.stateAnalyzed, dataset.stateSaved) }">
                        <div><strong>Analyzed</strong></div>
                        <div class="small">{{ dataset.stateAnalyzed.d }}</div>
                        <div>{{ dataset.stateAnalyzed.t }}</div>
                        <div>
                            <button class="btn btn-sm btn-success" data-ng-click="startSaving()">
                                <i class="fa fa-fw fa-database"></i> <span>Save</span>
                            </button>
                        </div>
                    </div>
                    <div data-ng-show="dataset.stateSaved" class="ds-state"
                         data-ng-class="{ 'later': isLater(dataset.stateSaved, undefined) }">
                        <div><strong>Saved</strong></div>
                        <div class="small">{{ dataset.stateSaved.d }}</div>
                        <div>{{ dataset.stateSaved.t }}</div>
                        <div data-ng-show="!dataset.skosField">
                            <button class="btn btn-sm btn-info" data-ng-click="goToDataset()">
                                <i class="fa fa-fw fa-eye"></i> <span>Explore</span>
                            </button>
                        </div>
                        <div data-ng-show="dataset.skosField">
                            <button class="btn btn-sm btn-info" data-ng-click="goToTerms()">
                                <i class="fa fa-fw fa-arrows-h"></i> <span>Map</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div data-ng-if="dataset.datasetErrorMessage">
                    <div class="alert alert-danger" role="alert">
                        <button type="button" class="close" data-dismiss="alert" data-ng-click="clearError()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <i class="fa fa-exclamation-circle"></i> {{ dataset.datasetErrorMessage }}
                        <hr/>
                        You must <a href data-ng-click="clearError()" class="alert-link">close/clear</a> this error message to continue
                    </div>
                </div>

                <h4 data-ng-show="dataset.metadata.name">
                    <span>"{{ dataset.metadata.name }}"</span>
                    <span data-ng-show="dataset.metadata.dataProvider">from "{{ dataset.metadata.dataProvider }}": </span>
                </h4>

                <div class="row">
                    <div class="tabbable dataset-tabs col-md-6">

                        <ul class="nav nav-tabs" role="tablist">
                            <li ng-class="{'active':leftTabOpen === 'metadata'}" >
                                <a href role="tab" data-ng-click="leftTabOpen = 'metadata'">Metadata</a>
                            </li>
                            <li ng-class="{'active':leftTabOpen === 'publication'}">
                                <a href role="tab" data-ng-click="leftTabOpen = 'publication'">Publication</a>
                            </li>
                            <li ng-class="{'active':leftTabOpen === 'categories'}" data-ng-show="categoriesEnabled">
                                <a href role="tab" data-ng-click="leftTabOpen ='categories'">Categories</a>
                            </li>
                            <li data-ng-class="{'active':leftTabOpen === 'check'}">
                                <a href role="tab" data-ng-click="leftTabOpen ='check'">Links</a>
                            </li>
                        </ul>

                        <div class="tab-content clearfix">
                            <div ng-switch="leftTabOpen">
                                <div ng-switch-when="metadata"><div data-ng-include="'dataset-metadata-form.html'">metadata form</div></div>
                                <div ng-switch-when="publication"><div data-ng-include="'publication-form.html'">publication form</div></div>
                                <div ng-switch-when="categories"><div data-ng-include="'categories-form.html'">categories form</div></div>
                                <div ng-switch-when="check"><div data-ng-include="'check-links.html'">check links</div></div>
                            </div>
                        </div>
                    </div>

                    <div class="tabbable dataset-tabs col-md-6">

                        <ul class="nav nav-tabs" role="tablist">
                            <li ng-class="{'active':rightTabOpen === 'drop'}" data-ng-show="dropSupported">
                                <a href role="tab" data-ng-click="rightTabOpen = 'drop'">File Drop</a>
                            </li>
                            <li ng-class="{'active':rightTabOpen === 'harvest'}">
                                <a href role="tab" data-ng-click="rightTabOpen ='harvest'">Harvest</a>
                            </li>
                            <li ng-class="{'active':rightTabOpen === 'harvest-cron'}" data-ng-show="dataset.harvestType">
                                <a href role="tab" data-ng-click="rightTabOpen = 'harvest-cron'">Periodic Update</a>
                            </li>
                            <li data-ng-class="{'active':rightTabOpen==='delete'}">
                                <a href role="tab" data-ng-click="rightTabOpen ='delete'" class="bg-danger"><i class="fa fa-trash fa-lg"></i>&nbsp;</a>
                            </li>
                        </ul>

                        <div class="tab-content clearfix">
                            <div ng-switch="rightTabOpen">
                                <div ng-switch-when="drop"><div data-ng-include="'drop-file-dataset.html'">drop file</div></div>
                                <div ng-switch-when="harvest"><div data-ng-include="'harvest-form.html'">harvest form</div></div>
                                <div ng-switch-when="harvest-cron"><div data-ng-include="'harvest-cron-form.html'">harvest cron form</div></div>
                                <div ng-switch-when="delete"><div data-ng-include="'dataset-delete.html'">deletion form</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/ng-template" id="dataset-metadata-form.html" class="">
    <form name="form" class="form file-harvest">
        <fieldset>
            <div class="form-group">
                <label for="meta_name">Dataset Name</label>
                <input id="meta_name" class="form-control input-sm" data-ng-model="dataset.edit.datasetName"/>
            </div>
            <div class="form-group">
                <label for="meta_description">Description</label>
                <input id="meta_description" class="form-control input-sm" data-ng-model="dataset.edit.datasetDescription"/>
            </div>
            <div class="form-group">
                <label for="meta_aggr">Aggregator</label>
                <input id="meta_aggr" class="form-control input-sm" data-ng-model="dataset.edit.datasetAggregator"/>
            </div>
            <div class="form-group">
                <label for="meta_owner">Owner</label>
                <input id="meta_owner" class="form-control input-sm" data-ng-model="dataset.edit.datasetOwner"/>
            </div>
            <div class="form-group">
                <label for="meta_language">Language</label>
                <input id="meta_language" class="form-control input-sm" data-ng-model="dataset.edit.datasetLanguage"/>
            </div>
            <div class="form-group">
                <label for="meta_rights">Rights</label>
                <input id="meta_rights" class="form-control input-sm" data-ng-model="dataset.edit.datasetRights"/>
            </div>
            <button type="button" class="btn btn-success btn-sm" data-ng-click="setMetadata()" data-ng-disabled="unchangedMetadata">
                <i class="fa fa-check-circle"></i>
                <span>Save</span>
            </button>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="drop-file-dataset.html">
    <div>
        <div class="file-drop col-md-12" ng-file-drop="receiveDropped($files)" ng-file-drag-over-class="file-drop-over" style="height: 300px">
            <span>Drag and drop your xml source or SIP file into this area</span>
            <div class="img-holder" data-ng-show="dataset.uploading">
                <i class="busy1 fa fa-gear fa-spin fa-5x"></i>
                <i class="busy2 fa fa-gear fa-spin-left fa-4x"></i>
                <i class="busy3 fa fa-gear fa-spin-left fa-5x"></i>
            </div>
            <div data-ng-if="dataset.uploadPercent">
                <progressbar class="progress-striped active" animate="true" value="dataset.uploadPercent" max="100" type="success">
                    <b>{{ dataset.uploadPercent }}%</b>
                </progressbar>
            </div>
        </div>
    </div>
</script>

<script type="text/ng-template" id="harvest-form.html">
    <form name="form" class="form file-harvest">
        <fieldset>
            <div class="form-group">
                <label for="harvest_type">Harvest Server Type</label>
                <div id="harvest_type" class="form-control">
                    <input type="radio" ng-model="dataset.edit.harvestType" value="pmh">
                    <span>OAI-PMH (record)</span>
                    <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <input type="radio" ng-model="dataset.edit.harvestType" value="pmh-rec">
                    <span>OAI-PMH (fields)</span>
                    <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <input type="radio" ng-model="dataset.edit.harvestType" value="adlib">
                    <span>AdLib API</span>
                </div>
            </div>
            <div class="form-group">
                <label for="harv_url">Server URL</label>
                <input id="harv_url" class="form-control" data-ng-model="dataset.edit.harvestURL" placeholder="http://..." required/>
            </div>
            <div class="form-group">
                <label for="harv_set">Server Dataset</label>
                <input id="harv_set" class="form-control" data-ng-model="dataset.edit.harvestDataset" placeholder="dataset"/>
            </div>
            <div class="form-group" data-ng-show="dataset.edit.harvestType != 'adlib'">
                <label for="harv_prefix">Metadata Prefix</label>
                <input id="harv_prefix" class="form-control" data-ng-model="dataset.edit.harvestPrefix" placeholder="prefix" required/>
            </div>
            <div class="form-group" data-ng-show="dataset.edit.harvestType == 'adlib'">
                <label for="harv_search">Search</label>
                <input id="harv_search" class="form-control" data-ng-model="dataset.edit.harvestSearch" placeholder="search" required/>
            </div>
            <button type="button" class="btn btn-warning pull-right" data-ng-click="startFirstHarvest()"  data-ng-disabled="!unchangedHarvest">
                <i class="fa fa-download"></i>
                <span>Harvest</span>
            </button>
            <button type="button" class="btn btn-success" data-ng-click="setHarvest()" data-ng-disabled="unchangedHarvest">
                <i class="fa fa-check-circle"></i>
                <span>Save</span>
            </button>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="harvest-cron-form.html">
    <form name="form" class="form file-harvest">
        <fieldset>
            <div class="form-group">
                <label for="hc_prev">Previous</label>
                <input id="hc_prev" class="form-control" data-ng-model="dataset.edit.harvestPreviousTime"/>
            </div>
            <div class="form-group">
                <label for="hc_delay">Delay</label>
                <input id="hc_delay" class="form-control" data-ng-model="dataset.edit.harvestDelay"/>
            </div>
            <div class="form-group">
                <label for="hc_unit">Unit</label>
                <input id="hc_unit" class="form-control" data-ng-model="dataset.edit.harvestDelayUnit"/>
            </div>
            <button type="button" class="btn btn-success" data-ng-click="setHarvestCron()" data-ng-disabled="unchangedHarvestCron">
                <i class="fa fa-check-circle"></i>
                <span>Save</span>
            </button>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="publication-form.html">
    <form name="form" class="form">
        <fieldset>
            <div class="checkbox">
                <label for="pub_pmh">Publish via OAI-PMH
                    <input id="pub_pmh" type="checkbox" data-ng-model="dataset.edit.publishOAIPMH" ng-true-value="'true'" ng-false-value="'false'"/>
                </label>
            </div>
            <div class="checkbox">
                <label for="pub_index">Publish in the Index
                    <input id="pub_index" type="checkbox" data-ng-model="dataset.edit.publishIndex" ng-true-value="'true'" ng-false-value="'false'"/>
                </label>
            </div>
            <div class="checkbox">
                <label for="pub_lod">Publish as Linked Open Data
                    <input id="pub_lod" type="checkbox" data-ng-model="dataset.edit.publishLOD" ng-true-value="'true'" ng-false-value="'false'"/>
                </label>
            </div>
            <button typ="button" class="btn btn-success btn-sm" data-ng-click="setPublish()" data-ng-disabled="unchangedPublish">
                <i class="fa fa-check-circle"></i>
                <span>Save</span>
            </button>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="categories-form.html">
    <form name="form" class="form">
        <fieldset>
            <div class="checkbox">
                <label for="cat">Include in Category Monitor Statistics
                    <input id="cat" type="checkbox" data-ng-model="dataset.edit.categoriesInclude" ng-true-value="'true'" ng-false-value="'false'"/>
                </label>
            </div>
            <button typ="button" class="btn btn-success btn-sm"  data-ng-click="setCategories()" data-ng-disabled="unchangedCategories">
                <i class="fa fa-check-circle"></i>
                <span>Save</span>
            </button>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="downloads.html">
</script>

<script type="text/ng-template" id="check-links.html">
    <ul class="list-unstyled">
        <li style="padding: 20px">
            <a class="" ng-href="{{ searchLink }}" target="_blank">
                <i class="fa fa-search"></i> <span>Search</span>
            </a>
        </li>
        <li style="padding: 20px">
            <a class="" ng-href="{{ apiLink }}" target="_blank">
                <i class="fa fa-binoculars"></i> <span>API</span>
            </a>
        </li>
        <li style="padding: 20px">
            <a class="" ng-href="{{ oaiPmhLink }}" target="_blank">
                <i class="fa fa-download"></i> <span>OAI-PMH</span>
            </a>
        </li>
    </ul>
</script>

<script type="text/ng-template" id="dataset-delete.html">
    <div class="alert alert-danger">
        By clicking the 'Delete' button below you will remove the entire dataset and all its accompanying information.
        This process is <em>not</em> reversable so proceed with caution!
    </div>
    <form name="form" class="form">
        <fieldset>
            <button class="btn btn-danger" data-ng-click="deleteDataset(dataset)"><i class="fa fa-trash"></i> Delete Dataset</button>
        </fieldset>
    </form>
</script>

<!--<script type="text/ng-template" id="sip-zip.html">-->
    <!--<ul class="sip-files">-->
        <!--<li data-ng-repeat="sip in sipFiles">-->
            <!--<span data-ng-class="{ 'latest': $index == 0}">{{ sip }}</span>-->
        <!--</li>-->
    <!--</ul>-->
<!--</script>-->

<!--<script type="text/ng-template" id="info.html">-->
    <!--<div class="file-info-harvest" data-ng-show="nonEmpty(dataset.harvest)">-->
        <!--<h4 class="heading">Harvest</h4>-->
        <!--<ul class="list-unstyled">-->
            <!--<li data-ng-repeat="(key, value) in dataset.harvest">-->
                <!--<b>{{ key }}</b> = "{{ value }}"-->
            <!--</li>-->
        <!--</ul>-->
    <!--</div>-->
    <!--<div class="file-info-namespace" data-ng-show="nonEmpty(dataset.namespaces)">-->
        <!--<h4 class="heading">Namespace(s)</h4>-->
        <!--<ul class="list-unstyled">-->
            <!--<li data-ng-repeat="(prefix, uri) in dataset.namespaces">-->
                <!--<b>{{ prefix }}</b> = "{{ uri }}"-->
            <!--</li>-->
        <!--</ul>-->
    <!--</div>-->
    <!--<div class="file-info-sip-facts" data-ng-show="nonEmpty(dataset.sipFacts)">-->
        <!--<h4 class="heading">SIP Facts</h4>-->
        <!--<ul class="list-unstyled">-->
            <!--<li data-ng-repeat="(key, value) in dataset.sipFacts">-->
                <!--<b>{{ key }}</b> = "{{ value }}"-->
            <!--</li>-->
        <!--</ul>-->
    <!--</div>-->
    <!--<div class="file-info-sip-hints" data-ng-show="nonEmpty(dataset.sipHints)">-->
        <!--<h4 class="heading">SIP Hints</h4>-->
        <!--<ul class="list-unstyled">-->
            <!--<li data-ng-repeat="(key, value) in dataset.sipHints">-->
                <!--<b>{{ key }}</b> = "{{ value }}"-->
            <!--</li>-->
        <!--</ul>-->
    <!--</div>-->
<!--</script>-->

<div class="fade" ng-file-drop-available="setDropSupported()" ng-show="!dropSupported">
    <h4>HTML5 Drop File is not supported! You need an HTML5 compliant browser.</h4>
</div>


