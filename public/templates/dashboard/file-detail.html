<div class="row" ng-show="tree">
    <div class="col-md-{{columns.left + columns.right}}">
        <div class="panel-heading">
            <h2><img data-ng-click="goToDashboard()" ng-src="/assets/images/narthex.png" style="width: 46; height:50"/><span> {{ fileName }}</span></h2>
        </div>
    </div>
    <div class="col-md-{{columns.left}}">
        <div data-ng-if="!aligning" class="panel panel-primary panel-schema">
            <div class="panel-heading">
                <h3 class="panel-title">Schema</h3>
            </div>
            <div class="panel-body">
                <div class="vertical-scroll" data-scrollable id="tree-list" data-offset="168" data-ng-style="{ 'max-height': elHeight, 'min-height': elHeight }">
                    <ul data-ng-controller="TreeCtrl" class="list-node">
                        <div ng-include="'node.html'" data-ng-controller="TreeNodeCtrl">tree</div>
                    </ul>
                </div>
            </div>
        </div>
        <div data-ng-if="aligning" class="panel panel-primary panel-schema">
            <div class="panel-heading">
                <span>
                    <span class="panel-title">Enrichment</span>
                    <span>
                        <button class="btn btn-success btn-xs pull-right" data-ng-click="setAligning(false)">Done</button>
                    </span>
                </span>
            </div>
            <div class="panel-body">
                <div class="vertical-scroll" data-scrollable id="skos-browser" data-offset="168" data-ng-style="{ 'max-height': elHeight, 'min-height': elHeight }">
                    <p>
                        This functionality is outside of the scope of the current project, but in the future this
                        panel could contain an enrichment interface tuned to the nature of the data in the field
                        listed to the right.
                    </p>
                    <dl>
                        <dt>SKOS Browser</dt>
                        <dd>
                            For each entry on the right, browsing a SKOS vocabulary here would allow curators to
                            make links from vocabularies arising from collection registration practice, pointing to
                            shared resources which better capture the intended meaning for aggregation purposes.
                        </dd>
                        <dt>Link Checker</dt>
                        <dd>
                            A URL field pointing to external resources can have all entries slowly and patiently checked
                            for availability.  Periodic checks could be scheduled as well, to verify that the
                            resources available.
                        </dd>
                        <dt>Geo-converter</dt>
                        <dd>
                            If a field contains a geo-coordinate, the contents could be verified, displayed on a map,
                            and converted to other coordinate systems if necessary.
                        </dd>
                        <dt>Date Fixer</dt>
                        <dd>
                            Date fields are notorious for having many formats in practice, so a date fixer could look
                            for ambiguous values according to chosen best practices and prompt for improvements.
                        </dd>
                        <dt>Syntax Normalizer</dt>
                        <dd>
                            Values internally delimited with semicolons or commas can be exploded into separate elements.
                            First name - surname order could be switched, that kind of thing.  Corner cases. Using
                            Javascript for this would allow live viewing of results in the browser.
                        </dd>
                        <dt>Enrichment Lookup</dt>
                        <dd>
                            Enrichment results from work performed elsewhere, such as time-consuming instance matching
                            algorithms on people, places, and events, could be dropped here so that the values
                            of this field can be rendered through the a translation lookup that renders the found
                            matches.
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-{{columns.right}}">
        <div class="panel panel-default panel-lists" data-ng-show="node">
            <div class="panel-heading">
                <span>
                    <span>
                        <button class="btn btn-success btn-xs left" data-ng-click="setAligning(true)"
                                data-ng-show="!aligning">Enrich</button>
                    </span>
                    <span class="panel-title">{{ node.path }}</span>
                </span>

            </div>
            <div class="panel-body">
                <div class="navbar navbar-inverse list-controls">
                    <ul class="nav navbar-nav">
                        <li data-ng-class="{ active: activeView == 'lengths' }">
                            <a href data-ng-click="fetchLengths()">Lengths</a>
                        </li>
                        <li data-ng-class="{ active: activeView == 'sample' }">
                            <a href data-ng-click="fetchSample()">Sample</a>
                        </li>
                        <li data-ng-class="{ active: activeView == 'histogram' }">
                            <a href data-ng-click="fetchHistogram()">Histogram</a>
                        </li>
                    </ul>
                    <div class="collapse navbar-collapse">
                        <ul class="nav navbar-nav navbar-right">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="fa fa-cloud-download"></i><span> API Access </span><i class="caret"></i></a>

                                <ul class="dropdown-menu">
                                    <li><a ng-href="{{apiPath}}/unique" target="_blank">All Values</a></li>
                                    <li><a ng-href="{{apiPath}}/histogram" target="_blank">Full Histogram</a></li>
                                </ul>
                            </li>
                        </ul>
                        <form class="navbar-form navbar-right" role="search">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Filter" ng-model="filterTyped">
                            </div>
                        </form>
                    </div>
                </div>

                <!--todo: an attempt at showing a graph example using d3 directives-->
                <div ng-show="node && !(sample || histogram)">
                    <div>
                        <span class="badge">{{ exampleData }}</span>
                        <nvd3-pie-chart
                                data="exampleData"
                                id="exampleId"
                                width="400"
                                height="200"
                                x="xFunction()"
                                y="yFunction()"
                                showLabels="true">
                            <svg></svg>
                        </nvd3-pie-chart>
                    </div>
                    <div>
                        <ul>
                            <li data-ng-repeat="count in node.lengths">
                                <span class="badge">{{ count[0] }}</span>
                                <span class="badge">{{ count[1] }}</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div ng-show="sample">
                    <div class="vertical-scroll" data-scrollable id="sample-list" data-offset="315" data-ng-style="{ 'max-height': elHeight, 'min-height': elHeight }">
                        <ul class="list-group">
                            <li data-ng-repeat="value in sample.sample | filter:filterText" class="list-group-item">
                                <span>{{ value }}</span>
                            </li>
                        </ul>
                    </div>

                </div>

                <div ng-show="histogram">
                    <div class="vertical-scroll" data-scrollable id="historgram-list" data-offset="315" data-ng-style="{ 'max-height': elHeight, 'min-height': elHeight }">
                        <ul class="list-group">
                            <li data-ng-repeat="count in histogram.histogram | filter:filterText" class="list-group-item" ng-class-odd="'odd'" ng-class-even="'even'">
                                <span class="badge">{{ count[0] }}</span>
                                <span>{{ count[1] }}</span>
                            </li>
                        </ul>
                    </div>

                </div>

                <div class="navbar navbar-default">
                    <div class="navbar-left sub-controls">
                        <span data-ng-if="histogram">
                            <button class="btn navbar-btn count-btn">({{histogram.entries}}/{{histogram.uniqueCount}})</button>
                            <button class="btn btn-default btn-sm navbar-btn" data-ng-click="moreHistogram();scrollTo({element: '#historgram-list', direction: 'down'})" data-ng-show="isMoreHistogram()">
                                More histogram entries
                            </button>
                            <span data-ng-if="histogram.complete && histogram.uniqueCount > 30">
                                <button class="btn btn-default btn-sm navbar-btn" data-ng-click="scrollTo({element: '#historgram-list', direction: 'up'})">
                                    <i class="fa fa-hand-o-up"></i>
                                </button>
                                <button class="btn btn-default btn-sm navbar-btn" data-ng-click="scrollTo({element: '#historgram-list', direction: 'down'})">
                                    <i class="fa fa-hand-o-down"></i>
                                </button>
                            </span>
                        </span>
                        <span ng-if="sample">
                            <button class="btn btn-default btn-sm navbar-btn" data-ng-show="isMoreSample()" data-ng-click="moreSample();scrollTo({element: '#sample-list', direction: 'down'})">
                                <i class="fa fa-plus-circle"></i> More samples
                            </button>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/ng-template" id="node.html">
    <li data-ng-click="selectNode(node, $event)">
        <div class="node" data-ng-class="{ 'chosen': node.chosen, 'active': node.lengths.length!=0 }">
            <span>{{ node.tag }}</span>
            <span class="badge pull-right" data-ng-class="{ 'badge-info' : node.lengths.length > 0 }"> {{ node.count }} </span>
        </div>
        <ul ng-if="node.kids" class="">
            <li class="" data-ng-repeat="(nodeIndex, node) in node.kids" data-ng-controller="TreeNodeCtrl">
                <div ng-include="'node.html'">node</div>
            </li>
        </ul>
    </li>
</script>