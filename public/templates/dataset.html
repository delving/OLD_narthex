<div class="row" ng-show="tree">
    <div class="col-md-12">
        <div class="file-path-info">
            <code>
                {{fileName}}{{activePath}}
            </code>
        </div>
    </div>

    <div class="col-md-5">
        <div class="panel panel-primary panel-schema">
            <div class="panel-heading">
                <span class="panel-title">Schema</span>
                <div class="btn-group pull-right">
                    <button type="button" class="btn btn-xs btn-primary dropdown-toggle" data-toggle="dropdown">
                        API <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a data-ng-href="{{ apiPrefix }}/{{ fileName }}/tree" target="_blank">JSON Tree</a></li>
                    </ul>
                </div>
            </div>
            <div class="panel-body">
                <div class="vertical-scroll" data-scrollable id="tree-list" data-offset="220" data-ng-style="{ 'max-height': elHeight, 'min-height': elHeight }">
                    <ul data-ng-controller="TreeCtrl" class="list-node">
                        <div data-ng-include="'node.html'" data-ng-controller="TreeNodeCtrl">tree</div>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-7" data-ng-if="!selectedNode">
        <div class="panel panel-heading panel-title">
            <p>&#8601; Select a schema path to show details.</p>
        </div>
    </div>
    <div class="col-md-7" data-ng-if="selectedNode">

        <div class="panel panel-default panel-lists">
                <div class="panel-heading list-controls">
                    <ul class="nav nav-tabs tabs-small pull-left">
                        <li data-ng-class="{ active: activeView == 'histogram' }" ><a href data-ng-click="fetchHistogram()">Histogram</a></li>
                        <li data-ng-class="{ active: activeView == 'sample' }" ><a href data-ng-click="fetchSample()">Samples</a></li>
                        <li data-ng-class="{ active: activeView == 'lengths' }" ><a href data-ng-click="fetchLengths()">Lengths</a></li>
                    </ul>

                    <!-- USE AS UNIQUE ELEMENT -->
                    <span data-ng-show="activeView == 'histogram' && histogramUnique">
                        <button class="btn btn-primary btn-xs" data-ng-click="setUniqueIdNode(selectedNode)" data-ng-disabled="uniqueIdNode == selectedNode">
                            <i class="fa fa-check-circle"></i><span> Use as Unique Element</span>
                        </button>
                    </span>
                    <!-- MAP AS VOCABULARY -->
                    <!--todo: also don't show this if there is no recordRoot-->
                    <span data-ng-show="activeView == 'histogram' && histogramVocabulary" class="pull-left">
                        <button class="btn btn-primary btn-xs" data-ng-click="goToTerms()">
                            <i class="fa fa-arrow-circle-right"></i><span> Terminology Mapping</span>
                        </button>
                    </span>
                    <!-- API DOWNLOADS -->
                    <div class="btn-group pull-right">
                        <button type="button" class="btn btn-primary btn-xs dropdown-toggle" data-toggle="dropdown">
                            API <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li><a ng-href="{{apiPathUnique}}" target="_blank">All Values</a></li>
                            <li><a ng-href="{{apiPathHistogram}}" target="_blank">Full Histogram</a></li>
                        </ul>
                    </div>
                </div>
            <div class="panel-body">
                <div data-ng-show="selectedNode && !(sample || histogram)" data-scrollable id="graph-list" data-offset="255" data-ng-style="{ 'max-height': elHeight, 'min-height': elHeight }">
                    <div>
                        <nvd3-pie-chart
                                data="selectedNode.lengths"
                                id="exampleId"
                                width="500"
                                height="500"
                                x="getX()"
                                y="getY()"
                                color="getColor()"
                                showLabels="true">
                            <svg></svg>
                        </nvd3-pie-chart>
                    </div>
                </div>

                <div ng-show="sample">
                    <div class="vertical-scroll" data-scrollable id="sample-list" data-offset="255" data-ng-style="{ 'max-height': elHeight, 'min-height': elHeight }">
                        <ul class="list-group">
                            <li data-ng-repeat="value in sample.sample | filter:filterText" class="list-group-item">
                                {{ value }}
                            </li>
                        </ul>
                    </div>
                </div>

                <div ng-show="histogram">
                    <div class="vertical-scroll" data-scrollable id="historgram-list" data-offset="255" data-ng-style="{ 'max-height': elHeight, 'min-height': elHeight }">
                        <ul class="list-group">
                            <li data-ng-repeat="count in histogram.histogram | filter:filterText" class="list-group-item clearfix">
                                <span class="node-content">{{ count[1] }}</span>
                                <span class="node-stats badge">{{ count[0] }} <span class="small">({{ count[2] | number:0 }}%)</span></span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="navbar navbar-default">
                    <div class="navbar-left sub-controls">
                        <span data-ng-if="histogram">
                            <span class="btn navbar-btn count-btn">( {{histogram.entries}} / {{histogram.uniqueCount}} )</span>
                            <button class="btn btn-success btn-xs navbar-btn" data-ng-class="{ disabled: !isMoreHistogram() }" data-ng-click="moreHistogram();scrollTo({element: '#historgram-list', direction: 'down'})">
                                More histogram entries
                            </button>
                            <span data-ng-if="histogram.uniqueCount > 30">
                                <button class="btn btn-primary btn-sm navbar-btn" data-ng-click="scrollTo({element: '#historgram-list', direction: 'up'})">
                                    <i class="fa fa-hand-o-up"></i>
                                </button>
                                <button class="btn btn-primary btn-sm navbar-btn" data-ng-click="scrollTo({element: '#historgram-list', direction: 'down'})">
                                    <i class="fa fa-hand-o-down"></i>
                                </button>
                            </span>
                        </span>
                        <span data-ng-if="sample">
                            <button class="btn btn-primary btn-sm navbar-btn" data-ng-show="isMoreSample()" data-ng-click="moreSample();scrollTo({element: '#sample-list', direction: 'down'})">
                                <i class="fa fa-plus-circle"></i> More samples
                            </button>
                        </span>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!--todo: highlight nodes which have terminology mappings-->
<script type="text/ng-template" id="node.html">
    <li data-ng-click="selectNode(node, $event)">
        <div class="node" data-ng-class="{ 'chosen': node.chosen, 'active': node.lengths.length != 0 }">
            <span  data-ng-show="!node.lengths.length > 0" data-ng-click="node.collapsed = !node.collapsed">
                <i data-ng-class="{ 'fa, fa-folder-open-o' : !node.collapsed, 'fa, fa-folder-o': node.collapsed}" class="fa pointer"></i>
            </span>
            <span>{{ node.tag }}</span>
            <span class="pull-right">
                <span data-ng-if="node == recordRootNode" class="badge badge-record-root">Record Root: {{ node.count }}</span>
                <span data-ng-if="node == uniqueIdNode" class="badge badge-unique">Unique Id: {{ node.count }}</span>
                <span data-ng-if="node.sourcePath" class="badge badge-mapped">Terminology: {{ node.count }}</span>
                <span data-ng-if="!(node == recordRootNode || node == uniqueIdNode || node.sourcePath)" class="badge badge-info">{{ node.count }}</span>
            </span>
        </div>
        <ul data-ng-if="node.kids && !node.collapsed" class="">
            <li class="" data-ng-repeat="(nodeIndex, node) in node.kids" data-ng-controller="TreeNodeCtrl">
                <div data-ng-include="'node.html'">node</div>
            </li>
        </ul>
    </li>
</script>